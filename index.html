<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Political Attitudes Study - IAT</title>

  <style>
    :root {
      --primary: #1a472a;
      --primary-light: #2d5f3f;
      --accent: #d4af37;
      --accent-light: #f4d98f;
      --bg-cream: #faf8f3;
      --bg-white: #ffffff;
      --text-dark: #2d3436;
      --text-medium: #636e72;
      --text-light: #95a5a6;
      --border: #e8e5de;
      --shadow: rgba(26, 71, 42, 0.08);
      --shadow-lg: rgba(26, 71, 42, 0.15);
      --error-red: #e74c3c;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      background: var(--bg-cream);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text-dark);
      overflow-x: hidden;
      font-weight: 400;
    }
    
    /* Typography */
    h1, h2, h3 {
      font-weight: 600;
      line-height: 1.2;
      color: var(--primary);
    }
    
    h1 {
      font-size: clamp(28px, 5vh, 42px);
      margin-bottom: 16px;
      letter-spacing: -0.02em;
    }
    
    h2 {
      font-size: clamp(22px, 3.5vh, 32px);
      margin-bottom: 12px;
      color: var(--primary-light);
    }
    
    h3 {
      font-size: clamp(18px, 2.8vh, 24px);
      margin-bottom: 10px;
    }
    
    p, li {
      font-size: clamp(15px, 2.2vh, 18px);
      line-height: 1.6;
      color: var(--text-medium);
      margin-bottom: 12px;
    }
    
    strong {
      font-weight: 600;
      color: var(--text-dark);
    }

    /* Main Container */
    .page-container {
      max-width: min(900px, 90vw);
      margin: 0 auto;
      padding: clamp(20px, 4vh, 40px) clamp(20px, 4vw, 40px);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .content-card {
      background: var(--bg-white);
      border-radius: 16px;
      padding: clamp(24px, 4vh, 48px) clamp(24px, 4vw, 48px);
      box-shadow: 0 2px 12px var(--shadow), 0 8px 40px var(--shadow-lg);
      width: 100%;
      border: 1px solid var(--border);
      animation: fadeSlideUp 0.5s ease-out;
    }
    
    @keyframes fadeSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Header Accent */
    .header-accent {
      width: 60px;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      margin-bottom: 20px;
      border-radius: 2px;
    }
    
    /* Info Boxes */
    .info-box {
      background: linear-gradient(135deg, rgba(26, 71, 42, 0.04), rgba(26, 71, 42, 0.08));
      border-left: 4px solid var(--primary);
      padding: clamp(16px, 2.5vh, 24px);
      margin: 20px 0;
      border-radius: 8px;
      font-size: clamp(14px, 2vh, 17px);
    }
    
    .info-box.warning {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.08), rgba(212, 175, 55, 0.12));
      border-left-color: var(--accent);
    }
    
    /* Category Pills */
    .category-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: clamp(12px, 2vw, 20px);
      margin: 24px 0;
    }
    
    .category-pill {
      background: var(--primary);
      color: white;
      padding: clamp(16px, 2.5vh, 24px) clamp(12px, 2vw, 20px);
      border-radius: 12px;
      text-align: center;
      font-weight: 600;
      font-size: clamp(16px, 2.5vh, 20px);
      letter-spacing: 0.02em;
      box-shadow: 0 4px 12px var(--shadow-lg);
      transition: transform 0.2s ease;
    }
    
    /* Buttons */
    .primary-btn {
      width: 100%;
      padding: clamp(14px, 2.5vh, 20px) clamp(20px, 3vw, 32px);
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: clamp(16px, 2.5vh, 19px);
      font-weight: 600;
      cursor: pointer;
      margin: 12px 0;
      box-shadow: 0 4px 16px var(--shadow-lg);
      transition: all 0.3s ease;
      letter-spacing: 0.02em;
    }
    
    .primary-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px var(--shadow-lg);
    }
    
    .primary-btn:active {
      transform: translateY(0);
    }
    
    /* List Styling */
    ul {
      margin: 16px 0 16px 24px;
      list-style: none;
    }
    
    ul li {
      position: relative;
      padding-left: 20px;
      margin-bottom: 8px;
    }
    
    ul li::before {
      content: "●";
      position: absolute;
      left: 0;
      color: var(--accent);
      font-size: 12px;
    }

    /* TEST SCREEN STYLES */
    .test-container {
      display: none;
      min-height: 100vh;
      background: var(--bg-white);
      padding: 20px;
    }

    .test-container.active {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .category-labels {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 800px;
      margin-bottom: 40px;
      padding: 0 20px;
    }

    .category-label {
      font-weight: 700;
      font-size: clamp(18px, 2.8vh, 24px);
      padding: 14px 24px;
      border: 3px solid var(--primary);
      border-radius: 10px;
      background: var(--bg-white);
      text-align: center;
      min-width: 200px;
    }

    .category-label.left {
      color: #2c5282;
      border-color: #2c5282;
    }

    .category-label.right {
      color: #22543d;
      border-color: #22543d;
    }

    .stimulus-area {
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      position: relative;
    }

    .stimulus {
      font-size: clamp(44px, 7.5vh, 68px);
      font-weight: 700;
      color: var(--primary);
      text-align: center;
      padding: 2vh 3vw;
    }

    .stimulus img {
      max-width: min(500px, 60vw);
      max-height: min(320px, 36vh);
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 4px 16px var(--shadow-lg);
      border: 2px solid var(--border);
    }

    .error-feedback {
      display: none;
      color: var(--error-red);
      font-size: clamp(100px, 18vh, 160px);
      font-weight: 900;
      text-shadow: 0 8px 20px rgba(231, 76, 60, 0.5);
      animation: errorPulse 0.4s ease-out;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .error-feedback.show {
      display: block;
    }

    @keyframes errorPulse {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    .instructions {
      margin-top: 40px;
      text-align: center;
      font-size: clamp(18px, 3vh, 24px);
      color: var(--text-medium);
      padding: 20px;
      background: rgba(26, 71, 42, 0.05);
      border-radius: 12px;
    }

    /* Progress */
    .progress-container {
      width: 100%;
      max-width: 800px;
      margin-bottom: 20px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    .progress-text {
      text-align: center;
      margin-top: 8px;
      font-size: 14px;
      color: var(--text-medium);
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- WELCOME SCREEN -->
  <div id="welcome" class="page-container">
    <div class="content-card">
      <div class="header-accent"></div>
      <h1>Prime Minister's Popularity Study</h1>
      <h2 style="margin-bottom: 24px;">Implicit Association Test</h2>
      
      <div class="info-box">
        <strong>Research Purpose</strong><br>
        This study examines automatic associations between political figures and positive/negative concepts. You will categorize photos of Mr. Narendra Modi and Dr. Manmohan Singh, along with positive and negative words.
      </div>
      
      <h3>What You'll Do</h3>
      <ul>
        <li><strong>Categorization Task:</strong> You'll see images and words appear on screen one at a time</li>
        <li><strong>Your Job:</strong> Press <strong>E</strong> for items that belong to categories on the left, or <strong>I</strong> for items on the right</li>
        <li><strong>Speed Matters:</strong> Respond as quickly as you can while being accurate</li>
        <li><strong>Mistakes Happen:</strong> If you make an error, a red X will appear—just press the correct key to continue</li>
      </ul>
      
      <div class="info-box warning">
        <strong>Time Required:</strong> Approximately 5-7 minutes<br>
        <strong>Important:</strong> There are no "right" or "wrong" answers—just respond based on your first instinct
      </div>
      
      <button class="primary-btn" onclick="startTest()">
        Begin Test
      </button>
    </div>
  </div>

  <!-- TEST SCREEN -->
  <div id="testScreen" class="test-container">
    <div class="progress-container">
      <div class="progress-bar">
        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
      </div>
      <div class="progress-text" id="progressText">Block 1 of 7</div>
    </div>

    <div class="category-labels">
      <div class="category-label left" id="leftLabel">Modi</div>
      <div class="category-label right" id="rightLabel">Manmohan</div>
    </div>

    <div class="stimulus-area">
      <div id="stimulus" class="stimulus"></div>
      <div id="errorFeedback" class="error-feedback">✕</div>
    </div>

    <div class="instructions" id="instructions">
      Press <strong>E</strong> for left category | Press <strong>I</strong> for right category
    </div>
  </div>

  <!-- RESULTS SCREEN -->
  <div id="results" class="page-container hidden">
    <div class="content-card">
      <div class="header-accent"></div>
      <h1>Test Complete</h1>
      <h2>Thank You for Participating</h2>
      
      <div class="info-box">
        <strong>Your results have been recorded.</strong><br>
        The Implicit Association Test measures the strength of automatic associations between concepts.
      </div>

      <div id="resultDetails"></div>
      
      <p style="margin-top: 30px;">
        This test is based on the methodology developed by Greenwald, McGhee, and Schwartz (1998) 
        and widely used in social psychology research.
      </p>
    </div>
  </div>

  <script>
    // ===========================================
    // GLOBAL VARIABLES
    // ===========================================
    const PID = 'P' + Date.now();
    let currentBlock = 0;
    let currentTrial = 0;
    let blockData = [];
    let allData = [];
    let startTime = 0;
    let awaitingResponse = false;
    let currentStimulus = null;
    let currentCorrectKey = null;

    console.log('=== IAT STARTED ===');
    console.log('Participant:', PID);

    // ===========================================
    // STIMULI
    // ===========================================
    const IMG_MODI = ['modi1.jpeg', 'modi2.jpeg', 'modi3.jpeg', 'modi4.jpeg', 'modi5.jpeg', 'modi6.jpeg'];
    const IMG_MANMOHAN = ['mohan1.jpeg', 'mohan2.jpeg', 'mohan3.jpeg', 'mohan4.jpeg', 'mohan5.jpeg', 'mohan6.jpeg'];
    const WORDS_GOOD = ['Triumph', 'Joyous', 'Celebrate', 'Cheerful', 'Beautiful', 'Terrific', 'Magnificent', 'Excellent'];
    const WORDS_BAD = ['Disgust', 'Annoy', 'Hate', 'Ugly', 'Awful', 'Bothersome', 'Hurtful', 'Negative'];

    // ===========================================
    // TEST BLOCKS CONFIGURATION
    // Based on Greenwald et al. (1998) methodology
    // ===========================================
    const testBlocks = [
      // Block 1: Practice - Modi vs Manmohan (20 trials)
      {
        name: 'Practice: Political Figures',
        leftCategory: 'Modi',
        rightCategory: 'Manmohan',
        leftStimuli: IMG_MODI.map(img => ({type: 'image', value: img, key: 'e'})),
        rightStimuli: IMG_MANMOHAN.map(img => ({type: 'image', value: img, key: 'i'})),
        trials: 20,
        practice: true
      },
      
      // Block 2: Practice - Good vs Bad (20 trials)
      {
        name: 'Practice: Word Valence',
        leftCategory: 'Good',
        rightCategory: 'Bad',
        leftStimuli: WORDS_GOOD.map(w => ({type: 'word', value: w, key: 'e'})),
        rightStimuli: WORDS_BAD.map(w => ({type: 'word', value: w, key: 'i'})),
        trials: 20,
        practice: true
      },
      
      // Block 3: Practice - Compatible (Modi+Good vs Manmohan+Bad) (20 trials)
      {
        name: 'Practice: Combined Categories',
        leftCategory: 'Modi or Good',
        rightCategory: 'Manmohan or Bad',
        leftStimuli: [
          ...IMG_MODI.map(img => ({type: 'image', value: img, key: 'e'})),
          ...WORDS_GOOD.map(w => ({type: 'word', value: w, key: 'e'}))
        ],
        rightStimuli: [
          ...IMG_MANMOHAN.map(img => ({type: 'image', value: img, key: 'i'})),
          ...WORDS_BAD.map(w => ({type: 'word', value: w, key: 'i'}))
        ],
        trials: 20,
        practice: true,
        combined: true
      },
      
      // Block 4: CRITICAL - Compatible (Modi+Good vs Manmohan+Bad) (40 trials)
      {
        name: 'Combined Categories',
        leftCategory: 'Modi or Good',
        rightCategory: 'Manmohan or Bad',
        leftStimuli: [
          ...IMG_MODI.map(img => ({type: 'image', value: img, key: 'e'})),
          ...WORDS_GOOD.map(w => ({type: 'word', value: w, key: 'e'}))
        ],
        rightStimuli: [
          ...IMG_MANMOHAN.map(img => ({type: 'image', value: img, key: 'i'})),
          ...WORDS_BAD.map(w => ({type: 'word', value: w, key: 'i'}))
        ],
        trials: 40,
        critical: true,
        blockType: 'compatible',
        combined: true
      },
      
      // Block 5: Practice - Reversed (Manmohan vs Modi) (20 trials)
      {
        name: 'Practice: Political Figures (Reversed)',
        leftCategory: 'Manmohan',
        rightCategory: 'Modi',
        leftStimuli: IMG_MANMOHAN.map(img => ({type: 'image', value: img, key: 'e'})),
        rightStimuli: IMG_MODI.map(img => ({type: 'image', value: img, key: 'i'})),
        trials: 20,
        practice: true,
        reversed: true
      },
      
      // Block 6: Practice - Incompatible (Manmohan+Good vs Modi+Bad) (20 trials)
      {
        name: 'Practice: Combined Categories',
        leftCategory: 'Manmohan or Good',
        rightCategory: 'Modi or Bad',
        leftStimuli: [
          ...IMG_MANMOHAN.map(img => ({type: 'image', value: img, key: 'e'})),
          ...WORDS_GOOD.map(w => ({type: 'word', value: w, key: 'e'}))
        ],
        rightStimuli: [
          ...IMG_MODI.map(img => ({type: 'image', value: img, key: 'i'})),
          ...WORDS_BAD.map(w => ({type: 'word', value: w, key: 'i'}))
        ],
        trials: 20,
        practice: true,
        combined: true
      },
      
      // Block 7: CRITICAL - Incompatible (Manmohan+Good vs Modi+Bad) (40 trials)
      {
        name: 'Combined Categories',
        leftCategory: 'Manmohan or Good',
        rightCategory: 'Modi or Bad',
        leftStimuli: [
          ...IMG_MANMOHAN.map(img => ({type: 'image', value: img, key: 'e'})),
          ...WORDS_GOOD.map(w => ({type: 'word', value: w, key: 'e'}))
        ],
        rightStimuli: [
          ...IMG_MODI.map(img => ({type: 'image', value: img, key: 'i'})),
          ...WORDS_BAD.map(w => ({type: 'word', value: w, key: 'i'}))
        ],
        trials: 40,
        critical: true,
        blockType: 'incompatible',
        combined: true
      }
    ];

    // ===========================================
    // CORE FUNCTIONS
    // ===========================================
    function startTest() {
      document.getElementById('welcome').classList.add('hidden');
      document.getElementById('testScreen').classList.add('active');
      currentBlock = 0;
      currentTrial = 0;
      blockData = [];
      allData = [];
      startBlock();
    }

    function startBlock() {
      if (currentBlock >= testBlocks.length) {
        endTest();
        return;
      }

      const block = testBlocks[currentBlock];
      currentTrial = 0;
      blockData = [];

      // Update labels
      document.getElementById('leftLabel').textContent = block.leftCategory;
      document.getElementById('rightLabel').textContent = block.rightCategory;
      
      // Update progress
      updateProgress();

      // Show instruction screen before block
      if (currentBlock === 0 || block.reversed || (currentBlock > 0 && testBlocks[currentBlock-1].practice && block.critical)) {
        showBlockInstructions();
      } else {
        setTimeout(() => nextTrial(), 500);
      }
    }

    function showBlockInstructions() {
      const block = testBlocks[currentBlock];
      awaitingResponse = true;
      
      let instructionText = `<strong>${block.name}</strong><br><br>`;
      
      if (block.reversed) {
        instructionText += '<span style="color: var(--error-red);">⚠ Categories have switched sides!</span><br><br>';
      }
      
      instructionText += `Press <strong>E</strong> for: ${block.leftCategory}<br>`;
      instructionText += `Press <strong>I</strong> for: ${block.rightCategory}<br><br>`;
      instructionText += '<em>Press SPACE to begin</em>';

      document.getElementById('stimulus').innerHTML = instructionText;
      document.getElementById('stimulus').style.fontSize = '24px';
      
      const spaceHandler = function(e) {
        if (e.code === 'Space') {
          document.removeEventListener('keydown', spaceHandler);
          awaitingResponse = false;
          setTimeout(() => nextTrial(), 300);
        }
      };
      
      document.addEventListener('keydown', spaceHandler);
    }

    function nextTrial() {
      const block = testBlocks[currentBlock];
      
      if (currentTrial >= block.trials) {
        currentBlock++;
        startBlock();
        return;
      }

      // Select stimulus alternating between categories
      const allStimuli = [...block.leftStimuli, ...block.rightStimuli];
      const shuffled = shuffleArray([...allStimuli]);
      currentStimulus = shuffled[currentTrial % shuffled.length];
      currentCorrectKey = currentStimulus.key;

      // Display stimulus
      const stimulusEl = document.getElementById('stimulus');
      document.getElementById('errorFeedback').classList.remove('show');
      
      if (currentStimulus.type === 'image') {
        stimulusEl.innerHTML = `<img src="${currentStimulus.value}" alt="Political figure">`;
      } else {
        stimulusEl.textContent = currentStimulus.value;
        stimulusEl.style.fontSize = 'clamp(44px, 7.5vh, 68px)';
      }

      startTime = Date.now();
      awaitingResponse = true;
    }

    function handleResponse(key) {
      if (!awaitingResponse) return;

      const rt = Date.now() - startTime;
      const correct = key === currentCorrectKey;

      if (!correct) {
        // Show error feedback
        document.getElementById('errorFeedback').classList.add('show');
        setTimeout(() => {
          document.getElementById('errorFeedback').classList.remove('show');
        }, 1000);
        return; // Wait for correct response
      }

      // Record data
      const block = testBlocks[currentBlock];
      const trialData = {
        block: currentBlock + 1,
        blockName: block.name,
        blockType: block.blockType || 'practice',
        trial: currentTrial + 1,
        stimulus: currentStimulus.value,
        stimulusType: currentStimulus.type,
        correctKey: currentCorrectKey,
        responseKey: key,
        correct: correct,
        rt: rt,
        timestamp: new Date().toISOString()
      };

      blockData.push(trialData);
      allData.push(trialData);

      awaitingResponse = false;
      currentTrial++;
      
      // Inter-trial interval
      setTimeout(() => nextTrial(), 250);
    }

    function updateProgress() {
      const totalBlocks = testBlocks.length;
      const progress = ((currentBlock) / totalBlocks) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('progressText').textContent = `Block ${currentBlock + 1} of ${totalBlocks}`;
    }

    function endTest() {
      document.getElementById('testScreen').classList.remove('active');
      document.getElementById('results').classList.remove('hidden');
      
      calculateResults();
    }

    function calculateResults() {
      // Extract critical block data
      const compatibleData = allData.filter(t => t.blockType === 'compatible' && t.correct);
      const incompatibleData = allData.filter(t => t.blockType === 'incompatible' && t.correct);

      if (compatibleData.length === 0 || incompatibleData.length === 0) {
        document.getElementById('resultDetails').innerHTML = `
          <div class="info-box warning">
            <strong>Insufficient data for analysis.</strong><br>
            Please ensure you complete all blocks of the test.
          </div>
        `;
        return;
      }

      // Calculate mean RTs
      const meanCompatible = compatibleData.reduce((sum, t) => sum + t.rt, 0) / compatibleData.length;
      const meanIncompatible = incompatibleData.reduce((sum, t) => sum + t.rt, 0) / incompatibleData.length;

      // Calculate D-score (standardized effect size)
      const sdCompatible = calculateSD(compatibleData.map(t => t.rt));
      const sdIncompatible = calculateSD(incompatibleData.map(t => t.rt));
      const pooledSD = Math.sqrt((sdCompatible ** 2 + sdIncompatible ** 2) / 2);
      const dScore = (meanIncompatible - meanCompatible) / pooledSD;

      // Interpretation
      let interpretation = '';
      let description = '';
      
      if (Math.abs(dScore) < 0.15) {
        interpretation = 'No clear automatic preference detected';
        description = 'Your response times were similar for both pairings.';
      } else if (dScore > 0.65) {
        interpretation = 'Strong automatic preference for Modi with positive words';
        description = 'You responded much faster when Modi was paired with positive words.';
      } else if (dScore > 0.35) {
        interpretation = 'Moderate automatic preference for Modi with positive words';
        description = 'You responded noticeably faster when Modi was paired with positive words.';
      } else if (dScore > 0.15) {
        interpretation = 'Slight automatic preference for Modi with positive words';
        description = 'You responded somewhat faster when Modi was paired with positive words.';
      } else if (dScore < -0.65) {
        interpretation = 'Strong automatic preference for Manmohan with positive words';
        description = 'You responded much faster when Manmohan was paired with positive words.';
      } else if (dScore < -0.35) {
        interpretation = 'Moderate automatic preference for Manmohan with positive words';
        description = 'You responded noticeably faster when Manmohan was paired with positive words.';
      } else {
        interpretation = 'Slight automatic preference for Manmohan with positive words';
        description = 'You responded somewhat faster when Manmohan was paired with positive words.';
      }

      // Calculate accuracy
      const totalTrials = allData.length;
      const correctTrials = allData.filter(t => t.correct).length;
      const accuracy = ((correctTrials / totalTrials) * 100).toFixed(1);

      // Display results
      document.getElementById('resultDetails').innerHTML = `
        <div style="background: var(--bg-cream); padding: 24px; border-radius: 12px; margin: 20px 0;">
          <h3 style="margin-bottom: 16px;">Your Results</h3>
          
          <div style="margin: 16px 0;">
            <strong>D-Score:</strong> ${dScore.toFixed(3)}
          </div>
          
          <div style="margin: 16px 0; padding: 16px; background: white; border-radius: 8px; border-left: 4px solid var(--accent);">
            <strong style="font-size: 18px;">${interpretation}</strong><br>
            <p style="margin-top: 8px;">${description}</p>
          </div>
          
          <div style="margin: 16px 0;">
            <strong>Overall Accuracy:</strong> ${accuracy}%
          </div>
          
          <div style="margin: 16px 0;">
            <strong>Average Response Time (Modi + Positive):</strong> ${Math.round(meanCompatible)} ms
          </div>
          
          <div style="margin: 16px 0;">
            <strong>Average Response Time (Manmohan + Positive):</strong> ${Math.round(meanIncompatible)} ms
          </div>
        </div>

        <div class="info-box">
          <strong>What does this mean?</strong><br>
          The IAT measures automatic associations that may differ from your conscious beliefs. 
          A positive D-score suggests stronger automatic association between Modi and positive concepts, 
          while a negative D-score suggests stronger automatic association between Manmohan and positive concepts.
          <br><br>
          <strong>Important Note:</strong> This test measures automatic associations, not explicit attitudes 
          or voting preferences. Many factors influence IAT scores, including recent exposure to media coverage.
        </div>
      `;

      // Log data for research purposes
      console.log('=== TEST COMPLETE ===');
      console.log('Participant:', PID);
      console.log('D-Score:', dScore.toFixed(3));
      console.log('Interpretation:', interpretation);
      console.log('All trial data:', allData);
    }

    function calculateSD(values) {
      const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
      const squaredDiffs = values.map(val => (val - mean) ** 2);
      const variance = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;
      return Math.sqrt(variance);
    }

    function shuffleArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    // ===========================================
    // EVENT LISTENERS
    // ===========================================
    document.addEventListener('keydown', function(e) {
      if (!awaitingResponse) return;
      
      if (e.code === 'KeyE' || e.code === 'KeyI') {
        e.preventDefault();
        const key = e.code === 'KeyE' ? 'e' : 'i';
        handleResponse(key);
      }
    });

    // Prevent accidental page refresh
    window.addEventListener('beforeunload', function(e) {
      if (currentBlock > 0 && currentBlock < testBlocks.length) {
        e.preventDefault();
        e.returnValue = '';
      }
    });
  </script>
</body>
</html>
